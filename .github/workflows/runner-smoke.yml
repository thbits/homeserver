name: Runner smoke test
on: workflow_dispatch

jobs:
  smoke:
    runs-on: self-hosted
    env:
      DOMAIN_NAME: ${{ vars.DOMAIN_NAME }}
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5
      - name: Show runner
        run: |
          echo "Runner: $HOSTNAME"
          echo "Domain: $DOMAIN_NAME"
          id
      - name: Docker sanity
        run: |
          docker version
          docker compose version
          docker ps
      - name: Run a test container
        run: docker run --rm alpine:3.20 sh -c "echo OK && uname -a"
      - name: Validate compose (if present)
        if: ${{ hashFiles('docker-compose.yml') != '' }}
        run: docker compose config -q
