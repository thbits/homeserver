name: Runner smoke test
on: workflow_dispatch

jobs:
  smoke:
    runs-on: self-hosted
    env:
      DOMAIN_NAME: ${{ vars.DOMAIN_NAME }}
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
      - name: Show runner
        run: |
          echo "Runner: $HOSTNAME"
          echo "Domain: $DOMAIN_NAME"
          id
      - name: Docker sanity
        run: |
          docker version
          docker compose version
          docker ps
      - name: Run a test container
        run: docker run --rm alpine:3.20 sh -c "echo OK && uname -a"
      - name: Validate compose (if present)
        if: ${{ hashFiles('docker-compose.yml') != '' }}
        run: docker compose config -q
