services:
  openwebui:
    image: ghcr.io/open-webui/open-webui:0.7.2@sha256:16d9a3615b45f14a0c89f7ad7a3bf151f923ed32c2e68f9204eb17d1ce40774b
    container_name: openwebui
    volumes:
      - ${DATADIR}/openwebui/data:/app/backend/data
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TIMEZONE}
      # Trusted header authentication from Authelia
      - WEBUI_AUTH_TRUSTED_EMAIL_HEADER=Remote-Email
      - WEBUI_AUTH_TRUSTED_NAME_HEADER=Remote-Name
      # LiteLLM backend configuration
      - OPENAI_API_BASE_URL=http://litellm:4000
      - OPENAI_API_KEY=${LITELLM_MASTER_KEY}
    labels:
      # Traefik routing
      - traefik.enable=true
      - traefik.http.routers.openwebui.rule=Host(`chat.${DOMAIN_NAME}`)
      - traefik.http.routers.openwebui.entrypoints=websecure
      - traefik.http.routers.openwebui.tls=true
      - traefik.http.routers.openwebui.tls.certresolver=myclouddns
      - traefik.http.services.openwebui.loadbalancer.server.port=8080

      # Middleware chain (with Authelia for SSO)
      - traefik.http.routers.openwebui.middlewares=geoblock@file,crowdsec-bouncer@docker,authelia-forwardauth@docker

      # Homepage integration
      - homepage.group=Other
      - homepage.name=OpenWebUI
      - homepage.icon=https://docs.openwebui.com/images/favicon.png
      - homepage.href=http://chat.${DOMAIN_NAME}/
      - homepage.description=AI chat interface
    restart: unless-stopped
    networks:
      - internal

networks:
  internal:
    external: true
