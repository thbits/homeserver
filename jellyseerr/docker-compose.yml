services:
  jellyseerr:
    container_name: jellyseerr
    image: ghcr.io/fallenbagel/jellyseerr:2.7.3@sha256:9cc9e9ee6cd5cf5a23feb45c37742ba34cfd6314d81d259cddb373a97ac92cdd
    ports:
      - "5055:5055"
    labels:
      - traefik.enable=true
      - traefik.http.routers.jellyseerr.rule=Host(`jellyseerr.${DOMAIN_NAME}`)
      - traefik.http.routers.jellyseerr.entrypoints=websecure
      - traefik.http.routers.jellyseerr.tls=true
      - traefik.http.routers.jellyseerr.tls.certresolver=myclouddns
      - traefik.http.routers.jellyseerr.middlewares=crowdsec-bouncer@docker,geoblock@file
      # NOTE: No authelia-forwardauth middleware - authentication handled by Jellyfin plugin
      - homepage.group=Media
      - homepage.name=Jellyseerr
      - homepage.icon=jellyseerr.png
      - homepage.href=http://jellyseerr.${DOMAIN_NAME}/
      - homepage.description=Media request application
      - homepage.widget.type=jellyseerr
      - homepage.widget.url=http://jellyseerr:5055
      - homepage.widget.key=${JELLYSEER_API_KEY}
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - UMASK=002
      - TZ=${TIMEZONE}
    volumes:
      - ${DATADIR}/jellyseerr/config:/app/config
      - jellyseerr_cache:/app/config/cache/images
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:5055/api/v1/status || exit 1
      start_period: 20s
      timeout: 3s
      interval: 15s
      retries: 3
    restart: unless-stopped
    networks:
      - internal

networks:
  internal:
    external: true

volumes:
  jellyseerr_cache:
    driver: local
    driver_opts:
      type: tmpfs
      device: tmpfs
      o: size=512M